<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hurdle</title>
    <script src="word_lists.js"></script>

    <style>
        :root {
            --color-correct: #6aaa64;
            --color-present: #c9b458;
            --color-absent: #787c7e;
            --color-key-bg: #d3d6da;
            --color-border: #d3d6da;
            --color-tile-border: #878a8c;
            --color-info-text: #000000;
            --color-reveal-btn: #dc3545; /* Red for reveal/lose */
            --color-disclaimer: #888; /* Gray for disclaimer text */
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen,
                Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: #ffffff;
            color: #000000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; /* Center the content vertically */
            min-height: 95vh;
            margin: 0;
        }

        /* --- Settings Screen --- */
        #settings-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px;
            border: 1px solid var(--color-border);
            border-radius: 8px;
            background-color: #f9f9f9;
        }

        #settings-screen h2 {
            margin-top: 0;
        }

        .setting {
            margin: 10px 0;
            font-size: 1.2rem;
            display: flex;
            flex-direction: column; /* Changed to column for disclaimer */
            align-items: center;
        }
        
        .setting-row {
            display: flex;
            align-items: center;
        }

        .setting label {
            margin-right: 10px;
        }

        .setting input[type="number"] {
            width: 60px;
            padding: 5px;
            font-size: 1.1rem;
            border: 1px solid var(--color-border);
            border-radius: 4px;
        }
        
        .setting input[type="number"]:disabled {
            background-color: #eee;
            color: #999;
        }
        
        /* NEW: Disclaimer Style */
        .setting-disclaimer {
            font-size: 0.9rem;
            color: var(--color-disclaimer);
            height: 1.2em; /* Reserve space */
            margin-top: 5px;
            font-style: italic;
        }

        .setting input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 5px;
        }
        
        /* Checkbox settings don't need disclaimer space */
        .setting.setting-checkbox {
            flex-direction: row;
        }

        #start-game-btn {
            font-size: 1.5rem;
            font-weight: bold;
            padding: 10px 20px;
            margin-top: 20px;
            cursor: pointer;
            background-color: var(--color-correct);
            color: white;
            border: none;
            border-radius: 5px;
        }

        /* --- Game Container --- */
        #game-container {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }

        header {
            position: relative;
            border-bottom: 1px solid var(--color-border);
            width: 100%;
            text-align: center;
            padding: 10px 0;
        }

        header h1 {
            font-size: 2.5rem;
            margin: 0;
            font-weight: bold;
            letter-spacing: 0.1em;
        }
        
        header h1 a {
            text-decoration: none;
            font-weight: bold;
        }
        header h1 a:hover {
            text-decoration: underline;
        }

        .title-win a {
            color: var(--color-correct);
        }
        .title-lose a {
            color: var(--color-reveal-btn);
        }

        #reveal-answer-btn {
            display: none;
            position: absolute;
            top: 50%;
            right: 15px;
            transform: translateY(-50%);
            padding: 5px 10px;
            font-size: 0.9rem;
            font-weight: bold;
            color: white;
            background-color: var(--color-reveal-btn);
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        #game-board {
            display: flex;
            flex-direction: column;
            grid-gap: 5px;
            padding: 10px;
            box-sizing: border-box;
            margin-top: 20px;
        }

        .guess-row {
            display: grid;
            /* grid-template-columns is now set by JS */
            grid-gap: 5px;
        }

        .guess-tile, .info-box {
            width: 55px;
            height: 55px;
            border: 2px solid var(--color-tile-border);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.2rem;
            font-weight: bold;
            text-transform: uppercase;
            box-sizing: border-box;
        }

        /* Tiles for 11-20 letters */
        .length-large .guess-tile {
            width: 35px;
            height: 35px;
            font-size: 1.5rem;
        }
        .length-large .info-box {
            width: 35px;
            height: 35px;
            font-size: 1.2rem;
        }
        
        /* NEW: Tiles for 21-50 letters */
        .length-xlarge .guess-tile {
            width: 20px;
            height: 20px;
            font-size: 0.8rem;
            border-width: 1px;
        }
        .length-xlarge .info-box {
            width: 20px;
            height: 20px;
            font-size: 0.8rem;
            border-width: 1px;
        }


        .guess-tile.filled {
            border-color: #565758;
        }

        .info-box {
            background-color: #cccccc;
            border-color: #878a8c;
            color: var(--color-info-text);
            font-size: 2rem;
        }

        .info-box.correct-info {
            background-color: var(--color-correct);
            border-color: var(--color-correct);
        }

        .info-box.present-info {
            background-color: var(--color-present);
            border-color: var(--color-present);
        }

        .guess-row.shake {
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        #keyboard {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }

        .keyboard-row {
            display: flex;
            justify-content: center;
            margin: 4px 0;
        }

        .key {
            font-size: 1rem;
            font-weight: bold;
            padding: 0;
            margin: 0 3px;
            height: 58px;
            border-radius: 4px;
            border: none;
            background-color: var(--color-key-bg);
            color: #000;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            text-transform: uppercase;
            min-width: 43px;
        }

        .key.large {
            min-width: 65px;
        }

        .key.hover {
            background-color: #c0c3c6;
        }

    </style>
</head>
<body>

    <div id="settings-screen">
        <h2>Settings</h2>
        
        <div class="setting">
            <div class="setting-row">
                <label for="setting-length">Word Length:</label>
                <input type="number" id="setting-length" value="5" min="1" max="50">
            </div>
            <div id="length-disclaimer" class="setting-disclaimer"></div>
        </div>
        
        <div class="setting">
            <div class="setting-row">
                <label for="setting-guesses">Number of Guesses:</label>
                <input type="number" id="setting-guesses" value="6" min="1" max="10">
            </div>
        </div>
        
        <div class="setting setting-checkbox">
            <input type="checkbox" id="setting-infinite">
            <label for="setting-infinite">Infinite Guesses</label>
        </div>
        
        <div class="setting setting-checkbox">
            <input type="checkbox" id="setting-reveal">
            <label for="setting-reveal">Enable Reveal Button</label>
        </div>
        
        <button id="start-game-btn">Start Game</button>
    </div>

    <div id="game-container">
        <header>
            <h1 id="title">HURDLE</h1>
            <button id="reveal-answer-btn">Reveal Answer</button>
        </header>

        <div id="game-board"></div>

        <div id="keyboard"></div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            // WORD_LISTS is loaded from word_lists.js

            // --- STATE ---
            let WORD_LENGTH = 5; 
            let GUESS_COUNT = 6; 
            let TARGET_WORDS_BY_LENGTH = []; 
            let targetWord = "";
            let currentRow = 0;
            let currentGuess = "";
            let isGameOver = false;

            // --- ELEMENTS ---
            const settingsScreen = document.getElementById("settings-screen");
            const gameContainer = document.getElementById("game-container");
            const startGameBtn = document.getElementById("start-game-btn");
            const settingLength = document.getElementById("setting-length"); 
            const settingGuesses = document.getElementById("setting-guesses");
            const settingInfinite = document.getElementById("setting-infinite");
            const settingReveal = document.getElementById("setting-reveal");
            const lengthDisclaimer = document.getElementById("length-disclaimer"); // NEW
            
            const gameBoard = document.getElementById("game-board");
            const keyboard = document.getElementById("keyboard");
            const revealAnswerBtn = document.getElementById("reveal-answer-btn");
            const titleElement = document.getElementById("title");
            
            const keysLayout = [
                "q", "w", "e", "r", "t", "y", "u", "i", "o", "p",
                "a", "s", "d", "f", "g", "h", "j", "k", "l",
                "enter", "z", "x", "c", "v", "b", "n", "m", "backspace"
            ];

            // --- NEW: Disclaimer Function ---
            function updateLengthDisclaimer() {
                const length = parseInt(settingLength.value, 10);
                let count = 0;
                
                if (length > 0 && WORD_LISTS[length]) {
                    count = WORD_LISTS[length].size;
                }

                let message = `(${count} words found)`;
                if (count === 0) {
                    message = "Warning: 0 words of this length!";
                } else if (count < 5) {
                    message = `Warning: Only ${count} words!`;
                } else if (count < 10) {
                    message = `Warning: Only ${count} words.`;
                } else if (count < 15) {
                    message = `Note: Only ${count} words.`;
                } else if (count < 25) {
                    message = `Note: ${count} words.`;
                }
                
                lengthDisclaimer.textContent = message;
            }
            
            // --- SETTINGS UI LISTENERS ---
            settingInfinite.addEventListener("change", () => {
                settingGuesses.disabled = settingInfinite.checked;
            });
            
            settingLength.addEventListener("input", updateLengthDisclaimer); // NEW

            // --- START GAME ---
            startGameBtn.addEventListener("click", () => {
                // 1. Get Settings
                const isInfinite = settingInfinite.checked;
                const canReveal = settingReveal.checked;
                
                let length = parseInt(settingLength.value, 10);
                WORD_LENGTH = (length >= 1 && length <= 50) ? length : 5; // Validate length
                
                if (isInfinite) {
                    GUESS_COUNT = 999;
                } else {
                    let guesses = parseInt(settingGuesses.value, 10);
                    GUESS_COUNT = (guesses > 0 && guesses <= 10) ? guesses : 6;
                }
                
                // 2. Check if word list for that length exists
                if (!WORD_LISTS[WORD_LENGTH] || WORD_LISTS[WORD_LENGTH].size === 0) {
                    alert(`Sorry, no words of length ${WORD_LENGTH} were found in your word list. Please select another length.`);
                    return;
                }
                
                // 3. Set class on game board for dynamic sizing
                gameBoard.classList.remove('length-large', 'length-xlarge');
                if (WORD_LENGTH > 20) {
                    gameBoard.classList.add('length-xlarge');
                } else if (WORD_LENGTH > 10) {
                    gameBoard.classList.add('length-large');
                }

                // 4. Swap screens
                settingsScreen.style.display = 'none';
                gameContainer.style.display = 'flex';
                
                initGame(canReveal);
            });

            // --- INITIALIZATION ---
            function initGame(canReveal) {
                gameBoard.innerHTML = ''; 
                currentRow = 0;
                currentGuess = "";
                isGameOver = false;

                titleElement.innerHTML = 'HURDLE';
                titleElement.classList.remove('title-win', 'title-lose');

                if (canReveal) {
                    revealAnswerBtn.style.display = 'block';
                } else {
                    revealAnswerBtn.style.display = 'none';
                }

                // Create keyboard
                keyboard.innerHTML = ''; 
                const row1 = document.createElement("div");
                row1.className = "keyboard-row";
                keysLayout.slice(0, 10).forEach(key => row1.appendChild(createKey(key)));
                
                const row2 = document.createElement("div");
                row2.className = "keyboard-row";
                row2.style.paddingLeft = "25px";
                keysLayout.slice(10, 19).forEach(key => row2.appendChild(createKey(key)));

                const row3 = document.createElement("div");
                row3.className = "keyboard-row";
                keysLayout.slice(19).forEach(key => row3.appendChild(createKey(key)));

                keyboard.appendChild(row1);
                keyboard.appendChild(row2);
                keyboard.appendChild(row3);

                // --- Word Selection ---
                TARGET_WORDS_BY_LENGTH = Array.from(WORD_LISTS[WORD_LENGTH]);
                targetWord = TARGET_WORDS_BY_LENGTH[Math.floor(Math.random() * TARGET_WORDS_BY_LENGTH.length)];
                console.log("Target Word:", targetWord);

                // Add Event Listeners
                document.removeEventListener("keydown", handlePhysicalKey);
                keyboard.removeEventListener("click", handleVirtualKey);
                revealAnswerBtn.removeEventListener("click", handleRevealAnswer);
                
                document.addEventListener("keydown", handlePhysicalKey);
                keyboard.addEventListener("click", handleVirtualKey);
                revealAnswerBtn.addEventListener("click", handleRevealAnswer);
                
                addNewGuessRow();
            }
            
            function showAnswerInHeader(state) {
                const NewHtml = '<a href="https://en.wiktionary.org/wiki/' + targetWord + '" target="_blank">' + targetWord + '</a>';
                titleElement.innerHTML = NewHtml.toLowerCase();
                
                titleElement.classList.remove('title-win', 'title-lose'); 
                
                if (state === 'win') {
                    titleElement.classList.add('title-win');
                } else { // 'lose' or 'reveal'
                    titleElement.classList.add('title-lose');
                }
                
                isGameOver = true;
                revealAnswerBtn.style.display = 'none';
            }

            function handleRevealAnswer() {
                if (isGameOver) return;
                showAnswerInHeader('reveal');
            }
            
            function addNewGuessRow() {
                let row = document.createElement("div");
                row.className = "guess-row";
                row.style.gridTemplateColumns = `repeat(${WORD_LENGTH}, 1fr) 0.5fr 0.5fr`;

                for (let j = 0; j < WORD_LENGTH; j++) {
                    let tile = document.createElement("div");
                    tile.className = "guess-tile";
                    tile.id = `tile-${currentRow}-${j}`;
                    row.appendChild(tile);
                }
                let correctInfoBox = document.createElement("div");
                correctInfoBox.className = "info-box correct-info";
                correctInfoBox.id = `info-correct-${currentRow}`;
                row.appendChild(correctInfoBox);

                let presentInfoBox = document.createElement("div");
                presentInfoBox.className = "info-box present-info";
                presentInfoBox.id = `info-present-${currentRow}`;
                row.appendChild(presentInfoBox);

                gameBoard.appendChild(row);
            }

            function createKey(key) {
                const keyElement = document.createElement("button");
                keyElement.className = "key";
                keyElement.dataset.key = key;

                if (key === "enter" || key === "backspace") {
                    keyElement.classList.add("large");
                    keyElement.textContent = key === "enter" ? "Enter" : "âŒ«";
                } else {
                    keyElement.textContent = key;
                }
                return keyElement;
            }

            function handlePhysicalKey(e) {
                if (isGameOver) return;
                
                if (e.key === "Enter") {
                    handleSubmitGuess();
                } else if (e.key === "Backspace") {
                    handleDeleteLetter();
                } else if (e.key.match(/^[a-z]$/i)) {
                    handleAddLetter(e.key.toLowerCase());
                }
            }

            function handleVirtualKey(e) {
                if (isGameOver) return;
                const key = e.target.dataset.key;
                if (!key) return;

                if (key === "enter") {
                    handleSubmitGuess();
                } else if (key === "backspace") {
                    handleDeleteLetter();
                } else {
                    handleAddLetter(key);
                }
            }

            function handleAddLetter(letter) {
                if (isGameOver || currentGuess.length >= WORD_LENGTH) return;
                currentGuess += letter;
                updateGrid();
            }

            function handleDeleteLetter() {
                if (isGameOver || currentGuess.length === 0) return;
                currentGuess = currentGuess.slice(0, -1);
                updateGrid();
            }

            function handleSubmitGuess() {
                if (isGameOver) return;
                
                if (currentGuess.length !== WORD_LENGTH) {
                    shakeRow();
                    return;
                }

                if (!WORD_LISTS[WORD_LENGTH].has(currentGuess)) {
                    shakeRow();
                    return;
                }
                revealGuess();
            }

            function updateGrid() {
                for (let i = 0; i < WORD_LENGTH; i++) {
                    const tile = document.getElementById(`tile-${currentRow}-${i}`);
                    if (tile) {
                        tile.textContent = currentGuess[i] || "";
                        if (currentGuess[i]) {
                            tile.classList.add("filled");
                        } else {
                            tile.classList.remove("filled");
                        }
                    }
                }
                if (currentGuess.length < WORD_LENGTH) {
                    const correctBox = document.getElementById(`info-correct-${currentRow}`);
                    const presentBox = document.getElementById(`info-present-${currentRow}`);
                    if (correctBox) correctBox.textContent = "";
                    if (presentBox) presentBox.textContent = "";
                }
            }

            function shakeRow() {
                const row = gameBoard.children[currentRow];
                if (row) {
                    row.classList.add("shake");
                    row.addEventListener("animationend", () => {
                        row.classList.remove("shake");
                    }, { once: true });
                }
            }

            function revealGuess() {
                const guess = currentGuess.split('');
                const answer = targetWord.split('');

                let correctCount = 0;
                let presentCount = 0;

                let tempAnswer = [...answer];
                let tempGuess = [...guess];

                for (let i = 0; i < WORD_LENGTH; i++) {
                    if (tempGuess[i] === tempAnswer[i]) {
                        correctCount++;
                        tempGuess[i] = null;
                        tempAnswer[i] = null;
                    }
                }

                for (let i = 0; i < WORD_LENGTH; i++) {
                    if (tempGuess[i] !== null) {
                        const answerIndex = tempAnswer.indexOf(tempGuess[i]);
                        if (answerIndex !== -1) {
                            presentCount++;
                            tempAnswer[answerIndex] = null;
                        }
                    }
                }

                document.getElementById(`info-correct-${currentRow}`).textContent = correctCount;
                document.getElementById(`info-present-${currentRow}`).textContent = presentCount;
                
                if (currentGuess === targetWord) {
                    showAnswerInHeader('win');
                    setTimeout(() => alert(`You win! The word was ${targetWord.toUpperCase()}`), 100);
                } else if (currentRow === GUESS_COUNT - 1 && !settingInfinite.checked) {
                    showAnswerInHeader('lose');
                    setTimeout(() => alert(`You lose! The word was ${targetWord.toUpperCase()}`), 100);
                } else {
                    currentRow++;
                    currentGuess = "";
                    
                    if (currentRow < GUESS_COUNT) {
                        addNewGuessRow();
                    }
                }
            }
            
            // --- NEW: Call disclaimer on page load ---
            updateLengthDisclaimer();
        });
    </script>
</body>
</html>